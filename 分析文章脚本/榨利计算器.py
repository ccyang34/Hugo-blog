#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æ¦¨åˆ©è®¡ç®—å™¨ - ä½¿ç”¨å…ƒçˆ¬è™«è·å–è±†æ²¹è±†ç²•æ•°æ®ï¼Œakshareè·å–è±†äºŒæ•°æ®
æ¦¨åˆ©è®¡ç®—å…¬å¼ï¼šæ¦¨åˆ© = (è±†æ²¹ä»·æ ¼ Ã— 0.185 + è±†ç²•ä»·æ ¼ Ã— 0.785) - è±†äºŒä»·æ ¼
"""

import akshare as ak
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import matplotlib.font_manager as fm
from datetime import datetime, timedelta
import os
import json
import requests
import time

class æ¦¨åˆ©è®¡ç®—å™¨:
    """æ¦¨åˆ©è®¡ç®—å™¨ç±»"""
    
    def __init__(self):
        """åˆå§‹åŒ–"""
        # è®¾ç½®ä¸­æ–‡å­—ä½“ - å…¼å®¹Windowså’ŒMac
        plt.rcParams['font.sans-serif'] = [
            # Windowså¸¸ç”¨å­—ä½“
            'SimHei', 'Microsoft YaHei', 'SimSun', 'FangSong',
            # Macå¸¸ç”¨å­—ä½“
            'STHeiti', 'PingFang HK', 'PingFang SC', 'Heiti TC', 'Arial Unicode MS'
        ]
        plt.rcParams['axes.unicode_minus'] = False
        
        # å‹æ¦¨äº§å‡ºæ¯”ä¾‹
        self.è±†æ²¹äº§å‡ºç‡ = 0.185  # 18.5%
        self.è±†ç²•äº§å‡ºç‡ = 0.785  # 78.5%
        
        # å‹æ¦¨æˆæœ¬ï¼ˆå…ƒ/å¨ï¼‰
        self.å‹æ¦¨æˆæœ¬ = 150.0
        
        print("ğŸš€ æ¦¨åˆ©è®¡ç®—å™¨åˆå§‹åŒ–å®Œæˆ")
        print(f"ğŸ’° å‹æ¦¨æˆæœ¬: {self.å‹æ¦¨æˆæœ¬} å…ƒ/å¨")
    
    def è·å–è±†äºŒæ•°æ®(self):
        """ä½¿ç”¨akshareè·å–è±†äºŒ(B0)æœŸè´§æ•°æ®"""
        print("\nğŸŒ± å¼€å§‹è·å–è±†äºŒ(B0)æœŸè´§æ•°æ®...")
        
        try:
            # è·å–è±†äºŒä¸»åŠ›åˆçº¦æ•°æ®
            è±†äºŒæ•°æ® = ak.futures_zh_daily_sina(symbol="B0")
            
            if è±†äºŒæ•°æ®.empty:
                print("âŒ è·å–çš„è±†äºŒæ•°æ®ä¸ºç©º")
                return None
            
            print(f"âœ… æˆåŠŸè·å–è±†äºŒæ•°æ®ï¼Œå…± {len(è±†äºŒæ•°æ®)} æ¡è®°å½•")
            print(f"ğŸ“… æ—¶é—´èŒƒå›´: {è±†äºŒæ•°æ®['date'].min()} è‡³ {è±†äºŒæ•°æ®['date'].max()}")
            
            # é‡å‘½ååˆ—åä¸ºä¸­æ–‡
            è±†äºŒæ•°æ® = è±†äºŒæ•°æ®.rename(columns={
                'date': 'æ—¥æœŸ',
                'open': 'å¼€ç›˜ä»·',
                'high': 'æœ€é«˜ä»·', 
                'low': 'æœ€ä½ä»·',
                'close': 'æ”¶ç›˜ä»·',
                'volume': 'æˆäº¤é‡',
                'hold': 'æŒä»“é‡',
                'settle': 'ç»“ç®—ä»·'
            })
            
            # ä½¿ç”¨æ”¶ç›˜ä»·ä½œä¸ºè±†äºŒä»·æ ¼
            è±†äºŒæ•°æ®['è±†äºŒä»·æ ¼'] = è±†äºŒæ•°æ®['æ”¶ç›˜ä»·']
            
            # åªä¿ç•™éœ€è¦çš„åˆ—
            è±†äºŒæ•°æ® = è±†äºŒæ•°æ®[['æ—¥æœŸ', 'è±†äºŒä»·æ ¼']]
            
            # è½¬æ¢æ—¥æœŸæ ¼å¼
            è±†äºŒæ•°æ®['æ—¥æœŸ'] = pd.to_datetime(è±†äºŒæ•°æ®['æ—¥æœŸ'])
            
            return è±†äºŒæ•°æ®
            
        except Exception as e:
            print(f"âŒ è·å–è±†äºŒæ•°æ®å¤±è´¥: {e}")
            return None
    
    def è·å–å…ƒçˆ¬è™«æ•°æ®(self, äº§å“ç±»å‹='Y'):
        """ä½¿ç”¨å…ƒçˆ¬è™«è·å–è±†æ²¹æˆ–è±†ç²•æ•°æ®"""
        
        äº§å“æ˜ å°„ = {'Y': 'è±†æ²¹', 'M': 'è±†ç²•'}
        äº§å“åç§° = äº§å“æ˜ å°„.get(äº§å“ç±»å‹, 'æœªçŸ¥äº§å“')
        
        print(f"\nğŸ“Š å¼€å§‹è·å–{äº§å“åç§°}æ•°æ®...")
        
        # API URL
        url = "https://www.jiaoyifamen.com/tools/api//future-basis/query"
        
        # è¯·æ±‚å‚æ•°
        params = {
            't': int(time.time() * 1000),  # æ—¶é—´æˆ³
            'type': äº§å“ç±»å‹  # ç±»å‹å‚æ•°
        }
        
        # è¯·æ±‚å¤´
        headers = {
            'Accept': 'application/json, text/plain, */*',
            'Accept-Encoding': 'gzip, deflate, br, zstd',
            'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6',
            'Priority': 'u=1, i',
            'Referer': 'https://www.jiaoyifamen.com/variety/varieties-varieties',
            'Sec-Fetch-Dest': 'empty',
            'Sec-Fetch-Mode': 'cors',
            'Sec-Fetch-Site': 'same-origin',
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
            'token': 'null'
        }
        
        try:
            # å‘é€GETè¯·æ±‚ï¼Œæ·»åŠ SSLéªŒè¯å¤„ç†
            response = requests.get(url, params=params, headers=headers, timeout=30, verify=False)
            
            if response.status_code == 200:
                print(f"âœ… {äº§å“åç§°}æ•°æ®è·å–æˆåŠŸ!")
                
                # è·å–å“åº”å†…å®¹
                æ•°æ® = response.json()
                
                # è§£ææ•°æ®
                è§£æç»“æœ = self.è§£æå…ƒçˆ¬è™«æ•°æ®(æ•°æ®, äº§å“ç±»å‹)
                
                if è§£æç»“æœ is not None:
                    print(f"ğŸ“ˆ æˆåŠŸè§£æ{äº§å“åç§°}æ•°æ®ï¼Œå…± {len(è§£æç»“æœ)} æ¡è®°å½•")
                    return è§£æç»“æœ
                else:
                    print(f"âŒ è§£æ{äº§å“åç§°}æ•°æ®å¤±è´¥")
                    return None
                    
            else:
                print(f"âŒ {äº§å“åç§°}æ•°æ®è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : {response.status_code}")
                return None
                
        except requests.exceptions.SSLError as e:
            print(f"âš ï¸ SSLè¿æ¥é”™è¯¯ï¼Œå°è¯•ä¸éªŒè¯SSLè¯ä¹¦...")
            try:
                # ç¦ç”¨SSLéªŒè¯é‡è¯•
                import urllib3
                urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
                response = requests.get(url, params=params, headers=headers, timeout=30, verify=False)
                
                if response.status_code == 200:
                    print(f"âœ… {äº§å“åç§°}æ•°æ®è·å–æˆåŠŸ!")
                    
                    # è·å–å“åº”å†…å®¹
                    æ•°æ® = response.json()
                    
                    # è§£ææ•°æ®
                    è§£æç»“æœ = self.è§£æå…ƒçˆ¬è™«æ•°æ®(æ•°æ®, äº§å“ç±»å‹)
                    
                    if è§£æç»“æœ is not None:
                        print(f"ğŸ“ˆ æˆåŠŸè§£æ{äº§å“åç§°}æ•°æ®ï¼Œå…± {len(è§£æç»“æœ)} æ¡è®°å½•")
                        return è§£æç»“æœ
                    else:
                        print(f"âŒ è§£æ{äº§å“åç§°}æ•°æ®å¤±è´¥")
                        return None
                else:
                    print(f"âŒ {äº§å“åç§°}æ•°æ®è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : {response.status_code}")
                    return None
                    
            except Exception as e2:
                print(f"âŒ è·å–{äº§å“åç§°}æ•°æ®å¼‚å¸¸: {e2}")
                return None
                
        except Exception as e:
            print(f"âŒ è·å–{äº§å“åç§°}æ•°æ®å¼‚å¸¸: {e}")
            return None
    
    def è§£æå…ƒçˆ¬è™«æ•°æ®(self, åŸå§‹æ•°æ®, äº§å“ç±»å‹):
        """è§£æå…ƒçˆ¬è™«è¿”å›çš„æ•°æ®ç»“æ„"""
        
        if not åŸå§‹æ•°æ® or 'data' not in åŸå§‹æ•°æ®:
            return None
        
        æ•°æ®å†…å®¹ = åŸå§‹æ•°æ®['data']
        
        # æŸ¥æ‰¾å…³é”®å­—æ®µ
        æ—¥æœŸæ•°æ® = None
        ä»·æ ¼æ•°æ® = None
        åŸºå·®æ•°æ® = None
        
        # æŸ¥æ‰¾æ—¥æœŸå­—æ®µ
        for å­—æ®µå in æ•°æ®å†…å®¹.keys():
            if å­—æ®µå == 'category':
                æ—¥æœŸæ•°æ® = æ•°æ®å†…å®¹[å­—æ®µå]
                print(f"ğŸ“… æ‰¾åˆ°æ—¥æœŸå­—æ®µ: {å­—æ®µå}, æ•°æ®é‡: {len(æ—¥æœŸæ•°æ®)}")
                break
        
        # å¦‚æœæ²¡æ‰¾åˆ°categoryï¼Œå°è¯•æŸ¥æ‰¾åŒ…å«categoryçš„å­—æ®µ
        if æ—¥æœŸæ•°æ® is None:
            for å­—æ®µå in æ•°æ®å†…å®¹.keys():
                if 'category' in å­—æ®µå.lower():
                    æ—¥æœŸæ•°æ® = æ•°æ®å†…å®¹[å­—æ®µå]
                    print(f"ğŸ“… æ‰¾åˆ°æ—¥æœŸå­—æ®µ: {å­—æ®µå}, æ•°æ®é‡: {len(æ—¥æœŸæ•°æ®)}")
                    break
        
        # æŸ¥æ‰¾ä»·æ ¼å­—æ®µ
        for å­—æ®µå in æ•°æ®å†…å®¹.keys():
            if 'price' in å­—æ®µå.lower() and 'value' in å­—æ®µå.lower():
                ä»·æ ¼æ•°æ® = æ•°æ®å†…å®¹[å­—æ®µå]
                print(f"ğŸ’° æ‰¾åˆ°ä»·æ ¼å­—æ®µ: {å­—æ®µå}, æ•°æ®é‡: {len(ä»·æ ¼æ•°æ®)}")
                break
        
        # æŸ¥æ‰¾åŸºå·®å­—æ®µ
        for å­—æ®µå in æ•°æ®å†…å®¹.keys():
            if 'basis' in å­—æ®µå.lower() and 'value' in å­—æ®µå.lower():
                åŸºå·®æ•°æ® = æ•°æ®å†…å®¹[å­—æ®µå]
                print(f"ğŸ“Š æ‰¾åˆ°åŸºå·®å­—æ®µ: {å­—æ®µå}, æ•°æ®é‡: {len(åŸºå·®æ•°æ®)}")
                break
        
        # æ£€æŸ¥æ•°æ®é•¿åº¦æ˜¯å¦ä¸€è‡´
        if not (æ—¥æœŸæ•°æ® and ä»·æ ¼æ•°æ® and åŸºå·®æ•°æ®):
            print("âŒ ç¼ºå°‘å¿…è¦çš„æ•°æ®å­—æ®µ")
            return None
        
        if len(æ—¥æœŸæ•°æ®) != len(ä»·æ ¼æ•°æ®) or len(æ—¥æœŸæ•°æ®) != len(åŸºå·®æ•°æ®):
            print(f"âš ï¸ æ•°æ®é•¿åº¦ä¸ä¸€è‡´: æ—¥æœŸ({len(æ—¥æœŸæ•°æ®)}), ä»·æ ¼({len(ä»·æ ¼æ•°æ®)}), åŸºå·®({len(åŸºå·®æ•°æ®)})")
            
            # å–æœ€å°é•¿åº¦
            æœ€å°é•¿åº¦ = min(len(æ—¥æœŸæ•°æ®), len(ä»·æ ¼æ•°æ®), len(åŸºå·®æ•°æ®))
            æ—¥æœŸæ•°æ® = æ—¥æœŸæ•°æ®[:æœ€å°é•¿åº¦]
            ä»·æ ¼æ•°æ® = ä»·æ ¼æ•°æ®[:æœ€å°é•¿åº¦]
            åŸºå·®æ•°æ® = åŸºå·®æ•°æ®[:æœ€å°é•¿åº¦]
            
            print(f"ğŸ”„ è°ƒæ•´ä¸ºç»Ÿä¸€é•¿åº¦: {æœ€å°é•¿åº¦}")
        
        # åˆ›å»ºDataFrame
        äº§å“æ•°æ® = pd.DataFrame({
            'æ—¥æœŸ': æ—¥æœŸæ•°æ®,
            'ä»·æ ¼': ä»·æ ¼æ•°æ®,
            'åŸºå·®': åŸºå·®æ•°æ®
        })
        
        # è¿‡æ»¤æ— æ•ˆæ•°æ®
        äº§å“æ•°æ® = äº§å“æ•°æ®[
            (äº§å“æ•°æ®['ä»·æ ¼'] != 0) & 
            (äº§å“æ•°æ®['åŸºå·®'] != 0) &
            (äº§å“æ•°æ®['ä»·æ ¼'] != "NaN") &
            (äº§å“æ•°æ®['åŸºå·®'] != "NaN")
        ]
        
        # è½¬æ¢æ—¥æœŸæ ¼å¼ - å¤„ç†æœˆ-æ—¥æ ¼å¼çš„æ—¥æœŸ
        try:
            # å°è¯•ç›´æ¥è½¬æ¢
            äº§å“æ•°æ®['æ—¥æœŸ'] = pd.to_datetime(äº§å“æ•°æ®['æ—¥æœŸ'])
        except Exception as e:
            print(f"âš ï¸ æ—¥æœŸè½¬æ¢å¤±è´¥: {e}")
            print(f"ğŸ“… å°è¯•å¤„ç†æœˆ-æ—¥æ ¼å¼æ—¥æœŸ...")
            
            # å‡è®¾æ—¥æœŸæ˜¯æœˆ-æ—¥æ ¼å¼ï¼Œéœ€è¦æ·»åŠ å¹´ä»½
            # ä½¿ç”¨å½“å‰å¹´ä»½ä½œä¸ºé»˜è®¤å¹´ä»½
            å½“å‰å¹´ä»½ = datetime.now().year
            
            # ä¸ºæ¯ä¸ªæ—¥æœŸæ·»åŠ å¹´ä»½
            å¸¦å¹´ä»½æ—¥æœŸ = []
            for æ—¥æœŸå­—ç¬¦ä¸² in äº§å“æ•°æ®['æ—¥æœŸ']:
                if isinstance(æ—¥æœŸå­—ç¬¦ä¸², str) and '-' in æ—¥æœŸå­—ç¬¦ä¸²:
                    try:
                        # è§£ææœˆ-æ—¥æ ¼å¼
                        æœˆ, æ—¥ = æ—¥æœŸå­—ç¬¦ä¸².split('-')
                        å®Œæ•´æ—¥æœŸ = f"{å½“å‰å¹´ä»½}-{æœˆ}-{æ—¥}"
                        å¸¦å¹´ä»½æ—¥æœŸ.append(å®Œæ•´æ—¥æœŸ)
                    except:
                        å¸¦å¹´ä»½æ—¥æœŸ.append(æ—¥æœŸå­—ç¬¦ä¸²)
                else:
                    å¸¦å¹´ä»½æ—¥æœŸ.append(æ—¥æœŸå­—ç¬¦ä¸²)
            
            # å†æ¬¡å°è¯•è½¬æ¢
            äº§å“æ•°æ®['æ—¥æœŸ'] = pd.to_datetime(å¸¦å¹´ä»½æ—¥æœŸ, errors='coerce')
            
            # è¿‡æ»¤æ‰è½¬æ¢å¤±è´¥çš„æ—¥æœŸ
            äº§å“æ•°æ® = äº§å“æ•°æ®.dropna(subset=['æ—¥æœŸ'])
            
            print(f"âœ… æ—¥æœŸè½¬æ¢å®Œæˆï¼Œå‰©ä½™ {len(äº§å“æ•°æ®)} æ¡æœ‰æ•ˆè®°å½•")
        
        # æ ¹æ®äº§å“ç±»å‹è®¾ç½®åˆ—å
        if äº§å“ç±»å‹ == 'Y':
            äº§å“æ•°æ® = äº§å“æ•°æ®.rename(columns={
                'ä»·æ ¼': 'è±†æ²¹ä»·æ ¼',
                'åŸºå·®': 'è±†æ²¹åŸºå·®'
            })
        elif äº§å“ç±»å‹ == 'M':
            äº§å“æ•°æ® = äº§å“æ•°æ®.rename(columns={
                'ä»·æ ¼': 'è±†ç²•ä»·æ ¼',
                'åŸºå·®': 'è±†ç²•åŸºå·®'
            })
        
        return äº§å“æ•°æ®
    
    def åˆå¹¶æ•°æ®(self, è±†æ²¹æ•°æ®, è±†ç²•æ•°æ®, è±†äºŒæ•°æ®):
        """åˆå¹¶è±†æ²¹ã€è±†ç²•å’Œè±†äºŒæ•°æ®"""
        print("\nğŸ”„ å¼€å§‹åˆå¹¶æ•°æ®...")
        
        if è±†æ²¹æ•°æ® is None or è±†ç²•æ•°æ® is None or è±†äºŒæ•°æ® is None:
            print("âŒ æ•°æ®ä¸å®Œæ•´ï¼Œæ— æ³•åˆå¹¶")
            return None
        
        # åˆå¹¶è±†æ²¹å’Œè±†ç²•æ•°æ®
        åˆå¹¶æ•°æ® = pd.merge(è±†æ²¹æ•°æ®, è±†ç²•æ•°æ®, on='æ—¥æœŸ', how='inner')
        
        # åˆå¹¶è±†äºŒæ•°æ®
        åˆå¹¶æ•°æ® = pd.merge(åˆå¹¶æ•°æ®, è±†äºŒæ•°æ®, on='æ—¥æœŸ', how='inner')
        
        print(f"âœ… æ•°æ®åˆå¹¶å®Œæˆï¼Œå…± {len(åˆå¹¶æ•°æ®)} æ¡æœ‰æ•ˆè®°å½•")
        
        return åˆå¹¶æ•°æ®
    
    def è®¡ç®—æ¦¨åˆ©(self, åˆå¹¶æ•°æ®):
        """è®¡ç®—æ¦¨åˆ©"""
        print("\nğŸ§® å¼€å§‹è®¡ç®—æ¦¨åˆ©...")
        
        if åˆå¹¶æ•°æ® is None or åˆå¹¶æ•°æ®.empty:
            print("âŒ æ•°æ®ä¸ºç©ºï¼Œæ— æ³•è®¡ç®—æ¦¨åˆ©")
            return None
        
        # è®¡ç®—ç°è´§ä»·æ ¼
        åˆå¹¶æ•°æ®['è±†æ²¹ç°è´§ä»·æ ¼'] = åˆå¹¶æ•°æ®['è±†æ²¹ä»·æ ¼'] + åˆå¹¶æ•°æ®['è±†æ²¹åŸºå·®']
        åˆå¹¶æ•°æ®['è±†ç²•ç°è´§ä»·æ ¼'] = åˆå¹¶æ•°æ®['è±†ç²•ä»·æ ¼'] + åˆå¹¶æ•°æ®['è±†ç²•åŸºå·®']
        
        # æ¦¨åˆ©è®¡ç®—å…¬å¼ï¼šæ¦¨åˆ© = ((è±†æ²¹ä»·æ ¼ + è±†æ²¹åŸºå·®) Ã— 0.185 + (è±†ç²•ä»·æ ¼ + è±†ç²•åŸºå·®) Ã— 0.785) - è±†äºŒä»·æ ¼ - å‹æ¦¨æˆæœ¬
        åˆå¹¶æ•°æ®['æ¦¨åˆ©'] = (
            (åˆå¹¶æ•°æ®['è±†æ²¹ä»·æ ¼'] + åˆå¹¶æ•°æ®['è±†æ²¹åŸºå·®']) * self.è±†æ²¹äº§å‡ºç‡ + 
            (åˆå¹¶æ•°æ®['è±†ç²•ä»·æ ¼'] + åˆå¹¶æ•°æ®['è±†ç²•åŸºå·®']) * self.è±†ç²•äº§å‡ºç‡ - 
            åˆå¹¶æ•°æ®['è±†äºŒä»·æ ¼'] - 
            self.å‹æ¦¨æˆæœ¬
        )
        
        # è®¡ç®—æ¦¨åˆ©ç‡
        åˆå¹¶æ•°æ®['æ¦¨åˆ©ç‡'] = (åˆå¹¶æ•°æ®['æ¦¨åˆ©'] / åˆå¹¶æ•°æ®['è±†äºŒä»·æ ¼']) * 100
        
        print(f"âœ… æ¦¨åˆ©è®¡ç®—å®Œæˆ")
        print(f"ğŸ’° æ¦¨åˆ©èŒƒå›´: {åˆå¹¶æ•°æ®['æ¦¨åˆ©'].min():.2f} è‡³ {åˆå¹¶æ•°æ®['æ¦¨åˆ©'].max():.2f}")
        print(f"ğŸ“Š å¹³å‡æ¦¨åˆ©: {åˆå¹¶æ•°æ®['æ¦¨åˆ©'].mean():.2f}")
        
        return åˆå¹¶æ•°æ®

    def è¿è¡Œæ¦¨åˆ©è®¡ç®—(self):
        """è¿è¡Œå®Œæ•´çš„æ¦¨åˆ©è®¡ç®—æµç¨‹"""
        print("=" * 70)
        print("ğŸš€ å¼€å§‹æ¦¨åˆ©è®¡ç®—æµç¨‹")
        print("=" * 70)
        
        # è·å–è±†äºŒæ•°æ®
        è±†äºŒæ•°æ® = self.è·å–è±†äºŒæ•°æ®()
        
        # è·å–è±†æ²¹æ•°æ®
        è±†æ²¹æ•°æ® = self.è·å–å…ƒçˆ¬è™«æ•°æ®('Y')
        
        # è·å–è±†ç²•æ•°æ®
        è±†ç²•æ•°æ® = self.è·å–å…ƒçˆ¬è™«æ•°æ®('M')
        
        # åˆå¹¶æ•°æ®
        åˆå¹¶æ•°æ® = self.åˆå¹¶æ•°æ®(è±†æ²¹æ•°æ®, è±†ç²•æ•°æ®, è±†äºŒæ•°æ®)
        
        if åˆå¹¶æ•°æ® is None:
            print("âŒ æ•°æ®åˆå¹¶å¤±è´¥ï¼Œæµç¨‹ç»ˆæ­¢")
            return None
        
        # è®¡ç®—æ¦¨åˆ©
        æ¦¨åˆ©æ•°æ® = self.è®¡ç®—æ¦¨åˆ©(åˆå¹¶æ•°æ®)
        
        if æ¦¨åˆ©æ•°æ® is None:
            print("âŒ æ¦¨åˆ©è®¡ç®—å¤±è´¥ï¼Œæµç¨‹ç»ˆæ­¢")
            return None
        
        # ä¿å­˜æ•°æ®
        self.ä¿å­˜æ•°æ®(æ¦¨åˆ©æ•°æ®)
        
        # ç”Ÿæˆåˆ†ææŠ¥å‘Š
        self.ç”Ÿæˆåˆ†ææŠ¥å‘Š(æ¦¨åˆ©æ•°æ®)
        
        # ç»˜åˆ¶å®Œæ•´å›¾è¡¨
        self.ç»˜åˆ¶å›¾è¡¨(æ¦¨åˆ©æ•°æ®)
        
        # ç»˜åˆ¶åŠå¹´å›¾è¡¨
        self.ç»˜åˆ¶åŠå¹´å›¾è¡¨(æ¦¨åˆ©æ•°æ®)
        
        print("=" * 70)
        print("âœ… æ¦¨åˆ©è®¡ç®—æµç¨‹å®Œæˆ!")
        print("=" * 70)
        
        return æ¦¨åˆ©æ•°æ®
    
    def ç”Ÿæˆåˆ†ææŠ¥å‘Š(self, æ¦¨åˆ©æ•°æ®):
        """ç”Ÿæˆæ¦¨åˆ©åˆ†ææŠ¥å‘Š"""
        print("\nğŸ“ˆ ç”Ÿæˆåˆ†ææŠ¥å‘Š...")
        
        if æ¦¨åˆ©æ•°æ® is None or æ¦¨åˆ©æ•°æ®.empty:
            return None
        
        æ—¶é—´æˆ³ = datetime.now().strftime("%Y%m%d_%H%M%S")
        æŠ¥å‘Šæ–‡ä»¶ = f"æ¦¨åˆ©åˆ†ææŠ¥å‘Š_{æ—¶é—´æˆ³}.txt"
        
        æŠ¥å‘Šå†…å®¹ = f"""æ¦¨åˆ©åˆ†ææŠ¥å‘Š
ç”Ÿæˆæ—¶é—´: {datetime.now().strftime("%Y-%m-%d %H:%M:%S")}
æ•°æ®æ¥æº: å…ƒçˆ¬è™«(è±†æ²¹è±†ç²•) + akshare(è±†äºŒ)

ğŸ“Š æ•°æ®æ¦‚å†µ
æ€»è®°å½•æ•°: {len(æ¦¨åˆ©æ•°æ®):,} æ¡
æ—¶é—´èŒƒå›´: {æ¦¨åˆ©æ•°æ®['æ—¥æœŸ'].min().strftime('%Y-%m-%d')} è‡³ {æ¦¨åˆ©æ•°æ®['æ—¥æœŸ'].max().strftime('%Y-%m-%d')}

ğŸ’° ä»·æ ¼ç»Ÿè®¡
è±†æ²¹ä»·æ ¼: {æ¦¨åˆ©æ•°æ®['è±†æ²¹ä»·æ ¼'].min():.2f} - {æ¦¨åˆ©æ•°æ®['è±†æ²¹ä»·æ ¼'].max():.2f} (å¹³å‡: {æ¦¨åˆ©æ•°æ®['è±†æ²¹ä»·æ ¼'].mean():.2f})
è±†ç²•ä»·æ ¼: {æ¦¨åˆ©æ•°æ®['è±†ç²•ä»·æ ¼'].min():.2f} - {æ¦¨åˆ©æ•°æ®['è±†ç²•ä»·æ ¼'].max():.2f} (å¹³å‡: {æ¦¨åˆ©æ•°æ®['è±†ç²•ä»·æ ¼'].mean():.2f})
è±†äºŒä»·æ ¼: {æ¦¨åˆ©æ•°æ®['è±†äºŒä»·æ ¼'].min():.2f} - {æ¦¨åˆ©æ•°æ®['è±†äºŒä»·æ ¼'].max():.2f} (å¹³å‡: {æ¦¨åˆ©æ•°æ®['è±†äºŒä»·æ ¼'].mean():.2f})

ğŸ“ˆ æ¦¨åˆ©åˆ†æ
æ¦¨åˆ©èŒƒå›´: {æ¦¨åˆ©æ•°æ®['æ¦¨åˆ©'].min():.2f} - {æ¦¨åˆ©æ•°æ®['æ¦¨åˆ©'].max():.2f}
å¹³å‡æ¦¨åˆ©: {æ¦¨åˆ©æ•°æ®['æ¦¨åˆ©'].mean():.2f}
æ¦¨åˆ©ç‡èŒƒå›´: {æ¦¨åˆ©æ•°æ®['æ¦¨åˆ©ç‡'].min():.2f}% - {æ¦¨åˆ©æ•°æ®['æ¦¨åˆ©ç‡'].max():.2f}%
å¹³å‡æ¦¨åˆ©ç‡: {æ¦¨åˆ©æ•°æ®['æ¦¨åˆ©ç‡'].mean():.2f}%

ğŸ“Š ç›ˆåˆ©æƒ…å†µ
ç›ˆåˆ©å¤©æ•°: {len(æ¦¨åˆ©æ•°æ®[æ¦¨åˆ©æ•°æ®['æ¦¨åˆ©'] > 0])} å¤©
äºæŸå¤©æ•°: {len(æ¦¨åˆ©æ•°æ®[æ¦¨åˆ©æ•°æ®['æ¦¨åˆ©'] < 0])} å¤©
ç›ˆäºå¹³è¡¡å¤©æ•°: {len(æ¦¨åˆ©æ•°æ®[æ¦¨åˆ©æ•°æ®['æ¦¨åˆ©'] == 0])} å¤©
ç›ˆåˆ©æ¯”ä¾‹: {(len(æ¦¨åˆ©æ•°æ®[æ¦¨åˆ©æ•°æ®['æ¦¨åˆ©'] > 0]) / len(æ¦¨åˆ©æ•°æ®) * 100):.1f}%

ğŸ”— ç›¸å…³æ€§åˆ†æ
è±†æ²¹-è±†ç²•ä»·æ ¼ç›¸å…³æ€§: {æ¦¨åˆ©æ•°æ®['è±†æ²¹ä»·æ ¼'].corr(æ¦¨åˆ©æ•°æ®['è±†ç²•ä»·æ ¼']):.4f}
è±†æ²¹-è±†äºŒä»·æ ¼ç›¸å…³æ€§: {æ¦¨åˆ©æ•°æ®['è±†æ²¹ä»·æ ¼'].corr(æ¦¨åˆ©æ•°æ®['è±†äºŒä»·æ ¼']):.4f}
è±†ç²•-è±†äºŒä»·æ ¼ç›¸å…³æ€§: {æ¦¨åˆ©æ•°æ®['è±†ç²•ä»·æ ¼'].corr(æ¦¨åˆ©æ•°æ®['è±†äºŒä»·æ ¼']):.4f}

è®¡ç®—å…¬å¼:
æ¦¨åˆ© = ((è±†æ²¹ä»·æ ¼ + è±†æ²¹åŸºå·®) Ã— {self.è±†æ²¹äº§å‡ºç‡} + (è±†ç²•ä»·æ ¼ + è±†ç²•åŸºå·®) Ã— {self.è±†ç²•äº§å‡ºç‡}) - è±†äºŒä»·æ ¼ - {self.å‹æ¦¨æˆæœ¬}
æ¦¨åˆ©ç‡ = (æ¦¨åˆ© / è±†äºŒä»·æ ¼) Ã— 100%
å‹æ¦¨æˆæœ¬: {self.å‹æ¦¨æˆæœ¬} å…ƒ/å¨
"""
        
        with open(æŠ¥å‘Šæ–‡ä»¶, 'w', encoding='utf-8') as f:
            f.write(æŠ¥å‘Šå†…å®¹)
        
        print(f"âœ… åˆ†ææŠ¥å‘Šå·²ç”Ÿæˆ: {æŠ¥å‘Šæ–‡ä»¶}")
        return æŠ¥å‘Šæ–‡ä»¶
    
    def ç»˜åˆ¶å›¾è¡¨(self, æ¦¨åˆ©æ•°æ®):
        """ç»˜åˆ¶æ¦¨åˆ©èµ°åŠ¿å›¾"""
        print("\nğŸ“Š ç»˜åˆ¶æ¦¨åˆ©èµ°åŠ¿å›¾...")
        
        if æ¦¨åˆ©æ•°æ® is None or æ¦¨åˆ©æ•°æ®.empty:
            return None
        
        æ—¶é—´æˆ³ = datetime.now().strftime("%Y%m%d_%H%M%S")
        å›¾è¡¨æ–‡ä»¶ = f"æ¦¨åˆ©èµ°åŠ¿å›¾_with_details_{æ—¶é—´æˆ³}.png"
        
        # åˆ›å»ºå›¾è¡¨ - 3x1 å¸ƒå±€
        fig, (ax1, ax2, ax3) = plt.subplots(3, 1, figsize=(12, 14))
        
        # è·å–æœ€æ–°æ•°æ®æ—¥æœŸ
        æœ€æ–°æ—¥æœŸ = æ¦¨åˆ©æ•°æ®['æ—¥æœŸ'].max().strftime('%Y-%m-%d')
        
        # æ·»åŠ å…¬å¼ä¿¡æ¯
        å…¬å¼æ–‡æœ¬ = (
            f"æ¦¨åˆ©è®¡ç®—å…¬å¼:\n"
            f"æ¦¨åˆ© = ((è±†æ²¹ä»·æ ¼ + è±†æ²¹åŸºå·®) Ã— {self.è±†æ²¹äº§å‡ºç‡} + (è±†ç²•ä»·æ ¼ + è±†ç²•åŸºå·®) Ã— {self.è±†ç²•äº§å‡ºç‡}) - è±†äºŒä»·æ ¼ - {self.å‹æ¦¨æˆæœ¬}å…ƒ/å¨\n"
            f"æ¦¨åˆ©ç‡ = (æ¦¨åˆ© / è±†äºŒä»·æ ¼) Ã— 100%\n"
            f"æœ€æ–°æ•°æ®æ—¥æœŸ: {æœ€æ–°æ—¥æœŸ}"
        )
        fig.text(0.02, 0.02, å…¬å¼æ–‡æœ¬, fontsize=9, 
                bbox=dict(boxstyle="round,pad=0.3", facecolor="lightblue", alpha=0.8),
                verticalalignment='bottom')
        
        # 1. æœŸè´§ä»·æ ¼èµ°åŠ¿ (é¡¶éƒ¨ ax1)
        # ä¸»å·¦è½´: è±†æ²¹ä»·æ ¼
        ax1.plot(æ¦¨åˆ©æ•°æ®['æ—¥æœŸ'], æ¦¨åˆ©æ•°æ®['è±†æ²¹ä»·æ ¼'], label='è±†æ²¹ä»·æ ¼', color='red', linewidth=1)
        ax1.set_title('æœŸè´§ä»·æ ¼èµ°åŠ¿ (åŒè½´)', fontsize=14)
        ax1.set_ylabel('è±†æ²¹ä»·æ ¼(å…ƒ/å¨)', color='red')
        ax1.tick_params(axis='y', labelcolor='red')
        ax1.grid(True, alpha=0.3)
        
        # å³è½´: è±†äºŒå’Œè±†ç²•ä»·æ ¼
        ax1_right = ax1.twinx()
        ax1_right.plot(æ¦¨åˆ©æ•°æ®['æ—¥æœŸ'], æ¦¨åˆ©æ•°æ®['è±†ç²•ä»·æ ¼'], label='è±†ç²•ä»·æ ¼(å³)', color='blue', linewidth=1)
        ax1_right.plot(æ¦¨åˆ©æ•°æ®['æ—¥æœŸ'], æ¦¨åˆ©æ•°æ®['è±†äºŒä»·æ ¼'], label='è±†äºŒä»·æ ¼(å³)', color='green', linewidth=1)
        ax1_right.set_ylabel('è±†ç²•/è±†äºŒä»·æ ¼(å…ƒ/å¨)')
        
        # åˆå¹¶å›¾ä¾‹ (ax1)
        lines1, labels1 = ax1.get_legend_handles_labels()
        lines2, labels2 = ax1_right.get_legend_handles_labels()
        ax1.legend(lines1 + lines2, labels1 + labels2, loc='upper left', fontsize=9)
        
        # 2. åŸºå·®èµ°åŠ¿ (ä¸­é—´ ax2)
        ax2.plot(æ¦¨åˆ©æ•°æ®['æ—¥æœŸ'], æ¦¨åˆ©æ•°æ®['è±†æ²¹åŸºå·®'], label='è±†æ²¹åŸºå·®', color='red', linewidth=1)
        ax2.plot(æ¦¨åˆ©æ•°æ®['æ—¥æœŸ'], æ¦¨åˆ©æ•°æ®['è±†ç²•åŸºå·®'], label='è±†ç²•åŸºå·®', color='blue', linewidth=1)
        ax2.axhline(y=0, color='gray', linestyle='--', alpha=0.5)
        ax2.set_title('ç°è´§åŸºå·®èµ°åŠ¿', fontsize=14)
        ax2.set_ylabel('åŸºå·®(å…ƒ/å¨)')
        ax2.grid(True, alpha=0.3)
        ax2.legend(loc='upper left', fontsize=9)
        
        # 3. æ¦¨åˆ©èµ°åŠ¿ (åº•éƒ¨ ax3)
        ax3.plot(æ¦¨åˆ©æ•°æ®['æ—¥æœŸ'], æ¦¨åˆ©æ•°æ®['æ¦¨åˆ©'], label='ç›˜é¢æ¦¨åˆ©', color='purple', linewidth=1)
        ax3.axhline(y=0, color='red', linestyle='--', alpha=0.5, label='ç›ˆäºå¹³è¡¡çº¿')
        ax3.set_title('æ¦¨åˆ©èµ°åŠ¿', fontsize=14)
        ax3.set_xlabel('æ—¥æœŸ')
        ax3.set_ylabel('æ¦¨åˆ©(å…ƒ/å¨)')
        ax3.grid(True, alpha=0.3)
        ax3.legend(loc='upper left', fontsize=9)
        
        plt.tight_layout()
        plt.savefig(å›¾è¡¨æ–‡ä»¶, dpi=300, bbox_inches='tight')
        plt.close()
        
        print(f"âœ… å›¾è¡¨å·²ä¿å­˜: {å›¾è¡¨æ–‡ä»¶}")
        return å›¾è¡¨æ–‡ä»¶
        
        print(f"âœ… å›¾è¡¨å·²ä¿å­˜: {å›¾è¡¨æ–‡ä»¶}")
        return å›¾è¡¨æ–‡ä»¶
    
    def ç»˜åˆ¶åŒºé—´å›¾è¡¨(self, æ¦¨åˆ©æ•°æ®, å¤©æ•°, åŒºé—´åç§°):
        """é€šç”¨åŒºé—´å›¾è¡¨ç»˜åˆ¶å‡½æ•°"""
        print(f"\nğŸ“Š ç»˜åˆ¶{åŒºé—´åç§°}èµ°åŠ¿å›¾...")
        
        if æ¦¨åˆ©æ•°æ® is None or æ¦¨åˆ©æ•°æ®.empty:
            return None
        
        # æå–æŒ‡å®šå¤©æ•°çš„æ•°æ®
        å½“å‰æ—¥æœŸ = æ¦¨åˆ©æ•°æ®['æ—¥æœŸ'].max()
        èµ·å§‹æ—¥æœŸ = å½“å‰æ—¥æœŸ - timedelta(days=å¤©æ•°)
        åŒºé—´æ•°æ® = æ¦¨åˆ©æ•°æ®[æ¦¨åˆ©æ•°æ®['æ—¥æœŸ'] >= èµ·å§‹æ—¥æœŸ]
        
        if åŒºé—´æ•°æ®.empty:
            print(f"âŒ è¿‘{åŒºé—´åç§°}æ•°æ®ä¸è¶³ï¼Œæ— æ³•ç»˜åˆ¶å›¾è¡¨")
            return None
        
        æ—¶é—´æˆ³ = datetime.now().strftime("%Y%m%d_%H%M%S")
        å›¾è¡¨æ–‡ä»¶ = f"æ¦¨åˆ©{åŒºé—´åç§°}èµ°åŠ¿å›¾_{æ—¶é—´æˆ³}.png"
        
        # åˆ›å»ºå›¾è¡¨ - 3x1 å¸ƒå±€
        fig, (ax1, ax2, ax3) = plt.subplots(3, 1, figsize=(12, 14))
        
        # è·å–æœ€æ–°æ•°æ®æ—¥æœŸ
        æœ€æ–°æ—¥æœŸ = åŒºé—´æ•°æ®['æ—¥æœŸ'].max().strftime('%Y-%m-%d')
        
        # æ·»åŠ å…¬å¼ä¿¡æ¯
        å…¬å¼æ–‡æœ¬ = (
            f"æ¦¨åˆ©è®¡ç®—å…¬å¼:\n"
            f"æ¦¨åˆ© = ((è±†æ²¹ä»·æ ¼ + è±†æ²¹åŸºå·®) Ã— {self.è±†æ²¹äº§å‡ºç‡} + (è±†ç²•ä»·æ ¼ + è±†ç²•åŸºå·®) Ã— {self.è±†ç²•äº§å‡ºç‡}) - è±†äºŒä»·æ ¼ - {self.å‹æ¦¨æˆæœ¬}å…ƒ/å¨\n"
            f"æ¦¨åˆ©ç‡ = (æ¦¨åˆ© / è±†äºŒä»·æ ¼) Ã— 100%\n"
            f"ç»Ÿè®¡èŒƒå›´: {åŒºé—´æ•°æ®['æ—¥æœŸ'].min().strftime('%Y-%m-%d')} è‡³ {æœ€æ–°æ—¥æœŸ} ({åŒºé—´åç§°})"
        )
        fig.text(0.02, 0.02, å…¬å¼æ–‡æœ¬, fontsize=9, 
                bbox=dict(boxstyle="round,pad=0.3", facecolor="lightblue", alpha=0.8),
                verticalalignment='bottom')
        
        # 1. æœŸè´§ä»·æ ¼èµ°åŠ¿ (ä¸Šå›¾ ax1)
        # ä¸»å·¦è½´: è±†æ²¹ä»·æ ¼
        ax1.plot(åŒºé—´æ•°æ®['æ—¥æœŸ'], åŒºé—´æ•°æ®['è±†æ²¹ä»·æ ¼'], label='è±†æ²¹ä»·æ ¼', color='red', linewidth=2)
        ax1.set_title(f'è¿‘{åŒºé—´åç§°}æœŸè´§ä»·æ ¼èµ°åŠ¿ (åŒè½´)', fontsize=14)
        ax1.set_ylabel('è±†æ²¹ä»·æ ¼(å…ƒ/å¨)', color='red')
        ax1.tick_params(axis='y', labelcolor='red')
        ax1.grid(True, alpha=0.3)
        
        # å³è½´: è±†äºŒå’Œè±†ç²•ä»·æ ¼
        ax1_right = ax1.twinx()
        ax1_right.plot(åŒºé—´æ•°æ®['æ—¥æœŸ'], åŒºé—´æ•°æ®['è±†ç²•ä»·æ ¼'], label='è±†ç²•ä»·æ ¼(å³)', color='blue', linewidth=2)
        ax1_right.plot(åŒºé—´æ•°æ®['æ—¥æœŸ'], åŒºé—´æ•°æ®['è±†äºŒä»·æ ¼'], label='è±†äºŒä»·æ ¼(å³)', color='green', linewidth=2)
        ax1_right.set_ylabel('è±†ç²•/è±†äºŒä»·æ ¼(å…ƒ/å¨)')
        
        # åˆå¹¶å›¾ä¾‹ (ax1)
        lines1, labels1 = ax1.get_legend_handles_labels()
        lines2, labels2 = ax1_right.get_legend_handles_labels()
        ax1.legend(lines1 + lines2, labels1 + labels2, loc='upper left', fontsize=9)
        
        # 2. åŸºå·®èµ°åŠ¿ (ä¸­é—´ ax2)
        ax2.plot(åŒºé—´æ•°æ®['æ—¥æœŸ'], åŒºé—´æ•°æ®['è±†æ²¹åŸºå·®'], label='è±†æ²¹åŸºå·®', color='red', linewidth=2)
        ax2.plot(åŒºé—´æ•°æ®['æ—¥æœŸ'], åŒºé—´æ•°æ®['è±†ç²•åŸºå·®'], label='è±†ç²•åŸºå·®', color='blue', linewidth=2)
        ax2.axhline(y=0, color='gray', linestyle='--', alpha=0.5)
        ax2.set_title(f'è¿‘{åŒºé—´åç§°}ç°è´§åŸºå·®èµ°åŠ¿', fontsize=14)
        ax2.set_ylabel('åŸºå·®(å…ƒ/å¨)')
        ax2.grid(True, alpha=0.3)
        ax2.legend(loc='upper left', fontsize=9)
        
        # 3. æ¦¨åˆ©èµ°åŠ¿ (ä¸‹å›¾ ax3)
        ax3.plot(åŒºé—´æ•°æ®['æ—¥æœŸ'], åŒºé—´æ•°æ®['æ¦¨åˆ©'], label='ç›˜é¢æ¦¨åˆ©', color='purple', linewidth=2)
        ax3.axhline(y=0, color='red', linestyle='-', alpha=0.5, label='ç›ˆäºå¹³è¡¡çº¿')
        
        # æ ‡è®°æœ€é«˜/æœ€ä½æ¦¨åˆ©
        max_val = åŒºå»ºæ•°æ®['æ¦¨åˆ©'].max() if 'æ³¨' == 'æ„' else åŒºé—´æ•°æ®['æ¦¨åˆ©'].max() # ä¿®å¤æ½œåœ¨æ‹¼å†™é”™è¯¯
        max_val = åŒºé—´æ•°æ®['æ¦¨åˆ©'].max()
        min_val = åŒºé—´æ•°æ®['æ¦¨åˆ©'].min()
        ax3.annotate(f'æœ€é«˜:{max_val:.0f}', xy=(åŒºé—´æ•°æ®['æ—¥æœŸ'].iloc[åŒºé—´æ•°æ®['æ¦¨åˆ©'].argmax()], max_val),
                    xytext=(0, 10), textcoords='offset points', ha='center', fontsize=8, color='purple')
        ax3.annotate(f'æœ€ä½:{min_val:.0f}', xy=(åŒºé—´æ•°æ®['æ—¥æœŸ'].iloc[åŒºé—´æ•°æ®['æ¦¨åˆ©'].argmin()], min_val),
                    xytext=(0, -15), textcoords='offset points', ha='center', fontsize=8, color='purple')

        ax3.set_title(f'è¿‘{åŒºé—´åç§°}æ¦¨åˆ©èµ°åŠ¿', fontsize=14)
        ax3.set_xlabel('æ—¥æœŸ')
        ax3.set_ylabel('æ¦¨åˆ©(å…ƒ/å¨)')
        ax3.grid(True, alpha=0.3)
        ax3.legend(loc='upper left', fontsize=9)
        
        plt.tight_layout()
        plt.savefig(å›¾è¡¨æ–‡ä»¶, dpi=300, bbox_inches='tight')
        plt.close()
        
        print(f"âœ… {åŒºé—´åç§°}å›¾è¡¨å·²ä¿å­˜: {å›¾è¡¨æ–‡ä»¶}")
        return å›¾è¡¨æ–‡ä»¶
        
        print(f"âœ… {åŒºé—´åç§°}å›¾è¡¨å·²ä¿å­˜: {å›¾è¡¨æ–‡ä»¶}")
        return å›¾è¡¨æ–‡ä»¶

    def ç»˜åˆ¶åŠå¹´å›¾è¡¨(self, æ¦¨åˆ©æ•°æ®):
        """ç»˜åˆ¶åŠå¹´åº¦çš„æ¦¨åˆ©èµ°åŠ¿å›¾"""
        return self.ç»˜åˆ¶åŒºé—´å›¾è¡¨(æ¦¨åˆ©æ•°æ®, 180, "åŠå¹´")

    def ç»˜åˆ¶ä¸€å¹´å›¾è¡¨(self, æ¦¨åˆ©æ•°æ®):
        """ç»˜åˆ¶ä¸€å¹´æœŸçš„æ¦¨åˆ©èµ°åŠ¿å›¾"""
        return self.ç»˜åˆ¶åŒºé—´å›¾è¡¨(æ¦¨åˆ©æ•°æ®, 365, "ä¸€å¹´")

    def ç»˜åˆ¶ä¸¤å¹´å›¾è¡¨(self, æ¦¨åˆ©æ•°æ®):
        """ç»˜åˆ¶ä¸¤å¹´æœŸçš„æ¦¨åˆ©èµ°åŠ¿å›¾"""
        return self.ç»˜åˆ¶åŒºé—´å›¾è¡¨(æ¦¨åˆ©æ•°æ®, 730, "ä¸¤å¹´")
    
    def ä¿å­˜æ•°æ®(self, æ¦¨åˆ©æ•°æ®):
        """ä¿å­˜æ¦¨åˆ©æ•°æ®åˆ°CSVæ–‡ä»¶"""
        print("\nğŸ’¾ ä¿å­˜æ¦¨åˆ©æ•°æ®...")
        
        if æ¦¨åˆ©æ•°æ® is None or æ¦¨åˆ©æ•°æ®.empty:
            return None
        
        æ—¶é—´æˆ³ = datetime.now().strftime("%Y%m%d_%H%M%S")
        æ•°æ®æ–‡ä»¶ = f"æ¦¨åˆ©æ•°æ®_{æ—¶é—´æˆ³}.csv"
        
        # ä¿å­˜æ•°æ®
        æ¦¨åˆ©æ•°æ®.to_csv(æ•°æ®æ–‡ä»¶, index=False, encoding='utf-8-sig')
        
        print(f"âœ… æ¦¨åˆ©æ•°æ®å·²ä¿å­˜: {æ•°æ®æ–‡ä»¶}")
        return æ•°æ®æ–‡ä»¶
    
    def è¿è¡Œæ¦¨åˆ©è®¡ç®—(self):
        """è¿è¡Œå®Œæ•´çš„æ¦¨åˆ©è®¡ç®—æµç¨‹"""
        print("=" * 70)
        print("ğŸš€ å¼€å§‹æ¦¨åˆ©è®¡ç®—æµç¨‹")
        print("=" * 70)
        
        # 1. è·å–è±†äºŒæ•°æ®
        è±†äºŒæ•°æ® = self.è·å–è±†äºŒæ•°æ®()
        
        # 2. è·å–è±†æ²¹æ•°æ®
        è±†æ²¹æ•°æ® = self.è·å–å…ƒçˆ¬è™«æ•°æ®('Y')
        
        # 3. è·å–è±†ç²•æ•°æ®
        è±†ç²•æ•°æ® = self.è·å–å…ƒçˆ¬è™«æ•°æ®('M')
        
        # 4. åˆå¹¶æ•°æ®
        åˆå¹¶æ•°æ® = self.åˆå¹¶æ•°æ®(è±†æ²¹æ•°æ®, è±†ç²•æ•°æ®, è±†äºŒæ•°æ®)
        
        if åˆå¹¶æ•°æ® is None:
            print("âŒ æ•°æ®åˆå¹¶å¤±è´¥ï¼Œæµç¨‹ç»ˆæ­¢")
            return
        
        # 5. è®¡ç®—æ¦¨åˆ©
        æ¦¨åˆ©æ•°æ® = self.è®¡ç®—æ¦¨åˆ©(åˆå¹¶æ•°æ®)
        
        # 6. ä¿å­˜æ•°æ®
        æ•°æ®æ–‡ä»¶ = self.ä¿å­˜æ•°æ®(æ¦¨åˆ©æ•°æ®)
        
        # 7. ç”ŸæˆæŠ¥å‘Š
        æŠ¥å‘Šæ–‡ä»¶ = self.ç”Ÿæˆåˆ†ææŠ¥å‘Š(æ¦¨åˆ©æ•°æ®)
        
        # 8. ç»˜åˆ¶å®Œæ•´å›¾è¡¨
        å›¾è¡¨æ–‡ä»¶ = self.ç»˜åˆ¶å›¾è¡¨(æ¦¨åˆ©æ•°æ®)
        
        # 9. ç»˜åˆ¶åŠå¹´å›¾è¡¨
        åŠå¹´å›¾è¡¨æ–‡ä»¶ = self.ç»˜åˆ¶åŠå¹´å›¾è¡¨(æ¦¨åˆ©æ•°æ®)
        
        # 10. ç»˜åˆ¶ä¸€å¹´å›¾è¡¨
        ä¸€å¹´å›¾è¡¨æ–‡ä»¶ = self.ç»˜åˆ¶ä¸€å¹´å›¾è¡¨(æ¦¨åˆ©æ•°æ®)
        
        # 11. ç»˜åˆ¶ä¸¤å¹´å›¾è¡¨
        ä¸¤å¹´å›¾è¡¨æ–‡ä»¶ = self.ç»˜åˆ¶ä¸¤å¹´å›¾è¡¨(æ¦¨åˆ©æ•°æ®)
        
        print("\n" + "=" * 70)
        print("âœ… æ¦¨åˆ©è®¡ç®—æµç¨‹å®Œæˆ!")
        print("=" * 70)
        
        if æ•°æ®æ–‡ä»¶:
            print(f"ğŸ“Š æ•°æ®æ–‡ä»¶: {æ•°æ®æ–‡ä»¶}")
        if æŠ¥å‘Šæ–‡ä»¶:
            print(f"ğŸ“ˆ åˆ†ææŠ¥å‘Š: {æŠ¥å‘Šæ–‡ä»¶}")
        if å›¾è¡¨æ–‡ä»¶:
            print(f"ğŸ“‰ å…¨å†å²èµ°åŠ¿å›¾è¡¨: {å›¾è¡¨æ–‡ä»¶}")
        if åŠå¹´å›¾è¡¨æ–‡ä»¶:
            print(f"ğŸ“Š åŠå¹´èµ°åŠ¿å›¾è¡¨: {åŠå¹´å›¾è¡¨æ–‡ä»¶}")
        if ä¸€å¹´å›¾è¡¨æ–‡ä»¶:
            print(f"ğŸ“Š ä¸€å¹´èµ°åŠ¿å›¾è¡¨: {ä¸€å¹´å›¾è¡¨æ–‡ä»¶}")
        if ä¸¤å¹´å›¾è¡¨æ–‡ä»¶:
            print(f"ğŸ“Š ä¸¤å¹´èµ°åŠ¿å›¾è¡¨: {ä¸¤å¹´å›¾è¡¨æ–‡ä»¶}")
        
        print("=" * 70)

def main():
    """ä¸»å‡½æ•°"""
    # åˆ›å»ºæ¦¨åˆ©è®¡ç®—å™¨å®ä¾‹
    è®¡ç®—å™¨ = æ¦¨åˆ©è®¡ç®—å™¨()
    
    # è¿è¡Œæ¦¨åˆ©è®¡ç®—
    è®¡ç®—å™¨.è¿è¡Œæ¦¨åˆ©è®¡ç®—()

if __name__ == "__main__":
    main()