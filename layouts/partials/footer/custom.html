<style>
    /* =========================================
   全局样式 - 最高优先级
   ========================================= */

    /* 只对有图片的文章应用右侧缩略图布局 */
    section.article-list article.has-image .article-header,
    .article-list article.has-image .article-header {
        display: flex !important;
        flex-direction: row-reverse !important;
        align-items: center !important;
        overflow: hidden !important;
    }

    /* 缩略图样式 - 统一尺寸，右侧显示 */
    section.article-list article.has-image .article-image,
    .article-list article.has-image .article-image {
        width: 100px !important;
        min-width: 100px !important;
        max-width: 100px !important;
        height: 80px !important;
        max-height: 80px !important;
        margin: 12px !important;
        display: block !important;
        flex-shrink: 0 !important;
        border-radius: 6px !important;
        overflow: hidden !important;
    }

    section.article-list article.has-image .article-image a,
    section.article-list article.has-image .article-image img,
    .article-list article.has-image .article-image a,
    .article-list article.has-image .article-image img {
        width: 100% !important;
        height: 100% !important;
        object-fit: cover !important;
        border-radius: 6px !important;
    }

    /* =========================================
   分类标签样式 - 统一放在左下角（新行）
   ========================================= */

    /* article-time 容器：使用 flex-wrap 让分类标签换行 */
    footer.article-time,
    .article-time {
        display: flex !important;
        flex-wrap: wrap !important;
        gap: 8px 15px !important;
        align-items: center !important;
    }

    /* 分类标签容器 - 强制占满整行，换到新行显示 */
    footer.article-time .article-category-footer,
    .article-time .article-category-footer,
    .article-category-footer {
        display: flex !important;
        align-items: center !important;
        margin-left: 0 !important;
        margin-right: auto !important;
        gap: 5px !important;
        flex-basis: 100% !important;
        /* 占满整行 */
        margin-top: 4px !important;
    }

    /* 分类标签样式 */
    footer.article-time .article-category-footer a.category-tag,
    .article-time .article-category-footer a.category-tag,
    .article-category-footer a.category-tag,
    a.category-tag {
        display: inline-flex !important;
        /* 行内弹性布局 */
        align-items: center !important;
        /* 垂直居中 */
        padding: 2px 8px !important;
        /* 内边距 */
        border-radius: 4px !important;
        /* 圆角半径 */
        line-height: 1.0 !important;
        /* 行高 */
        font-size: 1.0rem !important;
        /* 字体大小 */
        color: #ffffff !important;
        /* 文字颜色 */
        text-decoration: none !important;
        /* 移除下划线 */
        background-color: #34495e !important;
        /* 背景颜色 */
    }

    /* 根据文章序号循环使用5种颜色 */
    section.article-list article:nth-child(5n+1) a.category-tag,
    .article-list article:nth-child(5n+1) a.category-tag {
        background-color: #8ea885 !important;
    }

    section.article-list article:nth-child(5n+2) a.category-tag,
    .article-list article:nth-child(5n+2) a.category-tag {
        background-color: #df7988 !important;
    }

    section.article-list article:nth-child(5n+3) a.category-tag,
    .article-list article:nth-child(5n+3) a.category-tag {
        background-color: #0177b8 !important;
    }

    section.article-list article:nth-child(5n+4) a.category-tag,
    .article-list article:nth-child(5n+4) a.category-tag {
        background-color: #ffb900 !important;
    }

    section.article-list article:nth-child(5n+5) a.category-tag,
    .article-list article:nth-child(5n+5) a.category-tag {
        background-color: #6b69d6 !important;
    }

    /* =========================================
       分类页面标题样式
       ========================================= */

    /* 分类名称 h1.section-term - 加底色，使用动画轮换 */
    h1.section-term {
        display: inline-flex !important;
        width: fit-content !important;
        padding: 6px 12px !important;
        border-radius: 4px !important;
        background-color: #8ea885 !important;
        color: #ffffff !important;
        font-size: 1.6rem !important;
        margin: 0 !important;
        order: 1 !important;
        animation: color-cycle 10s ease-in-out infinite !important;
    }

    @keyframes color-cycle {

        0%,
        100% {
            background-color: #8ea885;
        }

        /* 绿 */
        20% {
            background-color: #df7988;
        }

        /* 粉 */
        40% {
            background-color: #0177b8;
        }

        /* 蓝 */
        60% {
            background-color: #ffb900;
        }

        /* 橙 */
        80% {
            background-color: #6b69d6;
        }

        /* 紫 */
    }

    /* 页面数量 h3.section-count - 在同一行右侧 */
    h3.section-count {
        display: inline-flex !important;
        font-size: 1.2rem !important;
        color: #888 !important;
        margin: 0 !important;
        order: 2 !important;
    }

    /* 容器用 flex 布局，左对齐，不换行 */
    .section-details {
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        justify-content: flex-start !important;
        align-items: center !important;
        gap: 10px !important;
        padding: 5px 0 !important;
    }

    /* 分类卡片：取消白色背景和阴影，降低高度 */
    .section-card {
        text-align: left !important;
        background: transparent !important;
        box-shadow: none !important;
        border: none !important;
        padding: 8px 15px !important;
        margin: 0 !important;
    }


    /* =========================================
       华尔街见闻风格 - 分类导航纯文字样式
       ========================================= */
    .main-category-nav .category-item {
        color: #333 !important;
        border: none !important;
        background: transparent !important;
    }

    /* 激活状态 - 红色加粗 + 下划线 */
    .main-category-nav .category-item.active {
        color: #e53935 !important;
        font-weight: 700 !important;
    }

    .main-category-nav .category-list .category-item:nth-child(5n+1),
    .main-category-nav .category-list .category-item:nth-child(5n+2),
    .main-category-nav .category-list .category-item:nth-child(5n+3),
    .main-category-nav .category-list .category-item:nth-child(5n+4),
    .main-category-nav .category-list .category-item:nth-child(5n+5) {
        background-color: transparent !important;
    }

    /* =========================================
       搜索图标样式 - 跟随导航栏
       ========================================= */
    .header-search-icon {
        position: absolute !important;
        top: 50% !important;
        transform: translateY(-50%) !important;
        right: 50px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        width: 30px !important;
        height: 30px !important;
        color: #ffffff !important;
        text-decoration: none !important;
        z-index: 1001 !important;
        transition: opacity 0.3s ease !important;
    }

    .header-search-icon:hover {
        opacity: 0.7 !important;
    }

    .header-search-icon svg {
        width: 22px !important;
        height: 22px !important;
    }

    /* 汉堡菜单用白色 */
    .hamburger-inner,
    .hamburger-inner::before,
    .hamburger-inner::after {
        background-color: #ffffff !important;
    }
</style>

<script>
    // 文章卡片整体可点击（仅限列表页，排除文章浏览页）
    document.addEventListener('DOMContentLoaded', function () {
        // 只获取文章列表中的 article 元素，排除主文章（.main-article）
        document.querySelectorAll('article:not(.main-article)').forEach(function (article) {
            // 找到文章链接
            var titleLink = article.querySelector('.article-title a');
            if (!titleLink) return;

            var href = titleLink.getAttribute('href');
            if (!href) return;

            // 添加 cursor 样式
            article.style.cursor = 'pointer';

            // 点击事件
            article.addEventListener('click', function (e) {
                // 如果点击的是分类标签或其他链接，不处理
                if (e.target.closest('a.category-tag') ||
                    e.target.closest('a') && e.target.closest('a') !== titleLink) {
                    return;
                }
                // 跳转到文章页
                window.location.href = href;
            });

            // 悬停效果
            article.addEventListener('mouseenter', function () {
                this.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
                this.style.transform = 'translateY(-2px)';
                this.style.transition = 'box-shadow 0.2s ease, transform 0.15s ease';
            });
            article.addEventListener('mouseleave', function () {
                this.style.boxShadow = '';
                this.style.transform = '';
            });
        });
    });
</script>

<!-- Busuanzi Analytics -->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"
    referrerpolicy="no-referrer-when-downgrade"></script>

<!-- =========================================
     资讯APP风格增强组件
     ========================================= -->

<!-- 阅读进度条 - 仅在文章页显示 -->
<div class="reading-progress-bar" id="readingProgress"></div>

<!-- 返回顶部按钮 -->
<button class="back-to-top" id="backToTop" aria-label="返回顶部">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
        stroke-linecap="round" stroke-linejoin="round">
        <polyline points="18 15 12 9 6 15"></polyline>
    </svg>
</button>

<!-- 移动端底部导航栏 -->
<nav class="mobile-bottom-nav" id="mobileBottomNav">
    <a href="/" class="nav-item" data-page="home">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        <span>首页</span>
    </a>
    <a href="/categories/" class="nav-item" data-page="categories">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="7" height="7"></rect>
            <rect x="14" y="3" width="7" height="7"></rect>
            <rect x="3" y="14" width="7" height="7"></rect>
            <rect x="14" y="14" width="7" height="7"></rect>
        </svg>
        <span>分类</span>
    </a>
    <a href="/search/" class="nav-item" data-page="search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <span>搜索</span>
    </a>
    <a href="/archives/" class="nav-item" data-page="archives">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        <span>归档</span>
    </a>
</nav>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // =========================================
        // 阅读进度条
        // =========================================
        const progressBar = document.getElementById('readingProgress');
        const isArticlePage = document.body.classList.contains('article-page');

        if (isArticlePage && progressBar) {
            window.addEventListener('scroll', function () {
                const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                const scrollPos = window.scrollY;
                const progress = (scrollPos / docHeight) * 100;
                progressBar.style.width = Math.min(progress, 100) + '%';
            });
        } else if (progressBar) {
            progressBar.style.display = 'none';
        }

        // =========================================
        // 返回顶部按钮
        // =========================================
        const backToTop = document.getElementById('backToTop');

        if (backToTop) {
            window.addEventListener('scroll', function () {
                if (window.scrollY > 300) {
                    backToTop.classList.add('visible');
                } else {
                    backToTop.classList.remove('visible');
                }
            });

            backToTop.addEventListener('click', function () {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        }

        // =========================================
        // 移动端底部导航高亮当前页
        // =========================================
        const bottomNav = document.getElementById('mobileBottomNav');
        if (bottomNav) {
            const currentPath = window.location.pathname;
            const navItems = bottomNav.querySelectorAll('.nav-item');

            navItems.forEach(function (item) {
                const href = item.getAttribute('href');
                if (currentPath === href ||
                    (href !== '/' && currentPath.startsWith(href))) {
                    item.classList.add('active');
                }
            });

            // 首页特殊处理
            if (currentPath === '/' || currentPath === '') {
                navItems[0].classList.add('active');
            }
        }

        // =========================================
        // 相对时间转换
        // =========================================
        function formatRelativeTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffSec = Math.floor(diffMs / 1000);
            const diffMin = Math.floor(diffSec / 60);
            const diffHour = Math.floor(diffMin / 60);
            const diffDay = Math.floor(diffHour / 24);
            const diffWeek = Math.floor(diffDay / 7);
            const diffMonth = Math.floor(diffDay / 30);

            if (diffSec < 60) {
                return '刚刚';
            } else if (diffMin < 60) {
                return diffMin + '分钟前';
            } else if (diffHour < 24) {
                return diffHour + '小时前';
            } else if (diffDay === 1) {
                return '昨天';
            } else if (diffDay === 2) {
                return '前天';
            } else if (diffDay < 7) {
                return diffDay + '天前';
            } else if (diffWeek < 4) {
                return diffWeek + '周前';
            } else if (diffMonth < 12) {
                return diffMonth + '个月前';
            } else {
                return Math.floor(diffMonth / 12) + '年前';
            }
        }

        // =========================================
        // 华尔街见闻风格 - 头条标签
        // 发布时间5小时以内的文章显示头条标签
        // 注意：必须在相对时间转换之前执行
        // =========================================
        const articleList = document.querySelector('.article-list');
        if (articleList) {
            const articles = articleList.querySelectorAll('article');
            const fiveHoursMs = 5 * 60 * 60 * 1000; // 5小时的毫秒数
            const now = new Date();

            articles.forEach(function (article) {
                const timeEl = article.querySelector('time[datetime]');
                if (timeEl) {
                    const datetime = timeEl.getAttribute('datetime');
                    if (datetime) {
                        const publishDate = new Date(datetime);
                        const diffMs = now - publishDate;
                        if (diffMs <= fiveHoursMs && diffMs >= 0) {
                            article.classList.add('is-headline');
                        }
                    }
                }
            });
        }

        // 转换文章列表中的时间显示，并隐藏图标
        const timeElements = document.querySelectorAll('.article-list .article-time--published');
        timeElements.forEach(function (el) {
            const datetime = el.getAttribute('datetime');
            if (datetime) {
                const relativeText = formatRelativeTime(datetime);
                // 只显示相对时间，不显示图标
                const parentDiv = el.parentElement;
                if (parentDiv) {
                    parentDiv.innerHTML = '<span class="relative-time">' + relativeText + '</span>';
                }
            }
        });



        // =========================================
        // 无限滚动加载（仅在非主页使用，主页由 category-switch.js 处理）
        // =========================================
        const categoryNav = document.querySelector('.main-category-nav');
        const articleListContainer = document.querySelector('.article-list, .taxonomy-grid');
        const paginationEl = document.querySelector('.pagination');

        // 如果有分类导航（主页），跳过这里的无限滚动，由 category-switch.js 处理
        if (articleListContainer && paginationEl && !categoryNav) {
            // 隐藏传统分页器
            paginationEl.style.display = 'none';

            // 获取下一页链接
            let nextPageLink = paginationEl.querySelector('a[aria-label="next page"]');
            if (!nextPageLink) {
                nextPageLink = paginationEl.querySelector('.page-link:last-child');
            }

            let isLoading = false;
            let hasMorePages = !!nextPageLink;

            // 创建加载提示
            const loadingIndicator = document.createElement('div');
            loadingIndicator.className = 'infinite-scroll-loading';
            loadingIndicator.innerHTML = '<span>加载中...</span>';
            loadingIndicator.style.cssText = 'text-align: center; padding: 20px; color: #999; display: none;';
            articleListContainer.parentNode.insertBefore(loadingIndicator, articleListContainer.nextSibling);

            // 加载下一页
            async function loadNextPage() {
                if (isLoading || !hasMorePages || !nextPageLink) return;

                isLoading = true;
                loadingIndicator.style.display = 'block';

                try {
                    const response = await fetch(nextPageLink.href);
                    const html = await response.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');

                    // 获取新文章或新分类方块
                    const newContent = doc.querySelectorAll('.article-list article, .taxonomy-grid .taxonomy-item');
                    newContent.forEach(function (item) {
                        const targetContainer = document.querySelector('.article-list') || document.querySelector('.taxonomy-grid');
                        if (targetContainer) {
                            targetContainer.appendChild(item.cloneNode(true));
                        }
                    });

                    // 获取新页面的下一页链接
                    const newPagination = doc.querySelector('.pagination');
                    if (newPagination) {
                        nextPageLink = newPagination.querySelector('a[aria-label="next page"]');
                        if (!nextPageLink) {
                            nextPageLink = newPagination.querySelector('.page-link:last-child');
                            if (nextPageLink && !nextPageLink.href) {
                                nextPageLink = null;
                            }
                        }
                    } else {
                        nextPageLink = null;
                    }

                    hasMorePages = !!nextPageLink;

                    // 重新应用头条标签和相对时间
                    applyHeadlineAndTime();

                } catch (error) {
                    console.error('加载下一页失败:', error);
                }

                isLoading = false;
                loadingIndicator.style.display = 'none';
            }

            // 重新应用头条标签和相对时间的函数
            function applyHeadlineAndTime() {
                const fiveHoursMs = 5 * 60 * 60 * 1000;
                const now = new Date();

                articleListContainer.querySelectorAll('article').forEach(function (article) {
                    const timeEl = article.querySelector('time[datetime]');
                    if (timeEl) {
                        const datetime = timeEl.getAttribute('datetime');
                        if (datetime) {
                            // 头条标签
                            const publishDate = new Date(datetime);
                            const diffMs = now - publishDate;
                            if (diffMs <= fiveHoursMs && diffMs >= 0) {
                                article.classList.add('is-headline');
                            }

                            // 相对时间
                            const relativeText = formatRelativeTime(datetime);
                            const parentDiv = timeEl.parentElement;
                            if (parentDiv && !parentDiv.querySelector('.relative-time')) {
                                parentDiv.innerHTML = '<span class="relative-time">' + relativeText + '</span>';
                            }
                        }
                    }
                });
            }

            // 监听滚动事件
            window.addEventListener('scroll', function () {
                const scrollPosition = window.innerHeight + window.scrollY;
                const threshold = document.body.offsetHeight - 500;

                if (scrollPosition >= threshold) {
                    loadNextPage();
                }
            });
        }
    });
</script>

<!-- 分类切换功能 -->
<script src="/js/category-switch.js"></script>